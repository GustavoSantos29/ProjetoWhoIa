ü§ñ Who IA - Backend

Fala! Esse √© o backend do Who IA, nosso sistema de monitoramento de reputa√ß√£o.

Abaixo tem tudo que voc√™ precisa pra conectar o front. O sistema usa JWT pra tudo, ent√£o a primeira miss√£o √© fazer o login funcionar.

üöÄ Como Rodar

    Clone o repo e instale as depend√™ncias:
    Bash

npm install
npx playwright install # Importante pro Scraper funcionar!

Configure o .env (usem a chave do Gemini de vcs e configurem os parametros de login do Banco).

Rode as migrations do banco:
Bash

npx prisma migrate dev

Suba o servidor:
Bash

    npm run dev

    O servidor roda em: http://localhost:3000

üîë Autentica√ß√£o (Comece aqui)

Todas as rotas abaixo (exceto login/register) precisam do Header de autoriza√ß√£o. Header: Authorization: Bearer <SEU_TOKEN_AQUI>

1. Criar Conta

    Rota: POST /auth/register

    Body:
    JSON

    {
      "email": "dev@teste.com",
      "password": "123"
    }

2. Fazer Login

    Rota: POST /auth/login

    Body: Mesma coisa do register.

    Retorno: Guarda esse token com carinho, voc√™ vai usar em tudo.
    JSON

    { "token": "eyJhbGciOiJIUz..." }

üè¢ Setup Inicial

Assim que o usu√°rio logar pela primeira vez, ele precisa criar a empresa que vai monitorar.

3. Criar Empresa

    Rota: POST /company

    Header: Bearer Token

    Body:
    JSON

    { "name": "Nome da Empresa para Buscar no Bing" }

4. Ver minha Empresa

    Rota: GET /company/me

    Retorno: Dados da empresa atrelada ao usu√°rio.

üß† O Motor (Scraper + IA)

Aqui √© onde a m√°gica acontece. Aviso: Essa rota √© lenta!

5. Disparar Atualiza√ß√£o

    Rota: POST /data/refresh

    O que ela faz: Vai no Bing, busca reclama√ß√µes da empresa, passa pro Gemini analisar sentimento/t√≥picos e salva no banco.

    Frontend: Coloca um Loading/Spinner nervoso aqui, porque pode levar uns 30 a 60 segundos.

    Retorno:
    JSON

    { "totalFound": 10, "totalSaved": 10 }

üìä Dashboard (Gr√°ficos e KPIs)

Essas rotas s√≥ retornam dados se o usu√°rio j√° tiver rodado o /data/refresh antes.

6. Cards de Estat√≠sticas (KPIs)

    Rota: GET /dashboard/stats

    Query Params: ?period=30 (Padr√£o √© 30 dias)

    Retorno:
    JSON

    {
      "period": "30 dias",
      "total": 15,
      "positive": 5,
      "negative": 10,
      "neutral": 0
    }

7. Nuvem de T√≥picos

    Rota: GET /dashboard/topics

    Query Params: ?period=30

    Retorno: Um objeto onde a chave √© o t√≥pico e o valor √© a contagem.
    JSON

    {
      "topics": {
        "entrega": 5,
        "atendimento": 3,
        "produto quebrado": 2
      }
    }

8. Feed de Reclama√ß√µes (Lista)

    Rota: GET /dashboard/feed

    Query Params:

        page: N√∫mero da p√°gina (come√ßa em 1).

        limit: Itens por p√°gina (padr√£o 10).

        sentiment: Filtrar por POSITIVE, NEGATIVE ou NEUTRAL (opcional).

    Exemplo: GET /dashboard/feed?page=1&sentiment=NEGATIVE

    Retorno:
    JSON

    {
      "data": [ ...array de reclama√ß√µes... ],
      "meta": { "total": 50, "page": 1, "lastPage": 5 }
    }

üÜò Tive um Erro, e agora? (Troubleshooting)

Se o back-end explodir na sua cara, provavelmente √© um desses motivos:

1. Erro 500 no /data/refresh (Timeout ou Playwright)

    Causa: O scraper n√£o conseguiu abrir o navegador ou o Bing bloqueou.

    Solu√ß√£o: Tenta rodar de novo. Se persistir, avisa o Gustavo pra checar se o npx playwright install foi rodado no servidor.

2. Erro de API Key (Gemini)

    Erro no log: API key not valid ou 404 Not Found.

    Solu√ß√£o: A chave do Google Gemini no .env expirou ou est√° errada.

3. Erro "Cannot find name 'Sentiment'" ou erros de banco

    Solu√ß√£o: Sempre que mexer no banco, tem que rodar npx prisma generate pra atualizar os tipos do TypeScript.

4. Token Inv√°lido (401 Unauthorized)

    Solu√ß√£o: O token JWT expira em 1 dia. Se der erro 401, faz logout no front e manda o usu√°rio logar de novo.